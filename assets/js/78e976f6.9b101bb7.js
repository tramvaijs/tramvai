"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9730],{3905:(e,n,r)=>{r.d(n,{Zo:()=>c,kt:()=>m});var t=r(7294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=t.createContext({}),u=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=u(e.components);return t.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(r),m=a,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return r?t.createElement(h,i(i({ref:n},c),{},{components:r})):t.createElement(h,i({ref:n},c))}));function m(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=r.length,i=new Array(s);i[0]=p;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var u=2;u<s;u++)i[u]=r[u];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}p.displayName="MDXCreateElement"},8073:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>u});var t=r(7462),a=(r(7294),r(3905));const s={},i=void 0,o={unversionedId:"references/libs/user-agent",id:"references/libs/user-agent",title:"user-agent",description:"A set of methods for parsing userAgent and getting browser data. Library for parsing and executing checks by:",source:"@site/tmp-docs/references/libs/user-agent.md",sourceDirName:"references/libs",slug:"/references/libs/user-agent",permalink:"/docs/references/libs/user-agent",draft:!1,editUrl:"https://github.com/tramvaijs/tramvai/-/edit/master/docs/tmp-docs/references/libs/user-agent.md",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"url",permalink:"/docs/references/libs/url"},next:{title:"webpack-dedupe-plugin",permalink:"/docs/references/libs/webpack-dedupe-plugin"}},l={},u=[{value:"parseClientHintsHeaders",id:"parseclienthintsheaders",level:2},{value:"parseClientHintsUserAgentData",id:"parseclienthintsuseragentdata",level:2},{value:"parseUserAgentHeader",id:"parseuseragentheader",level:2},{value:"isBrowserSatisfiesRequirements",id:"isbrowsersatisfiesrequirements",level:2}],c={toc:u};function d({components:e,...n}){return(0,a.kt)("wrapper",(0,t.Z)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A set of methods for parsing userAgent and getting browser data. Library for parsing and executing checks by:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"userAgent string. Based on ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/faisalman/ua-parser-js"},"ua-parser-js")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Client_hints"},"Client Hints")," headers")),(0,a.kt)("h2",{id:"parseclienthintsheaders"},"parseClientHintsHeaders"),(0,a.kt)("p",null,"Used on the ",(0,a.kt)("strong",{parentName:"p"},"server")," to supplement information from ClientHints headers (",(0,a.kt)("inlineCode",{parentName:"p"},"sec-ch-ua"),"). The parseClientHintsUserAgentData method constructs an object with information based on the headers, enriches it with browser details, fills in additional fields, and ensures backward compatibility in naming. Essentially, it performs data preparation and some data hygiene. For example, when parsing headers with low entropy,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'const headers = {\n  \'sec-ch-ua\': \'"Chromium";v="106", "Google Chrome";v="106", "Not;A=Brand";v="99"\',\n  \'sec-ch-ua-mobile\': \'?0\',\n  \'sec-ch-ua-platform\': \'"Windows"\',\n};\n')),(0,a.kt)("p",null,"We get"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const userAgent = {\n  browser: {\n    browserEngine: 'chrome',\n    major: '106',\n    name: 'chrome',\n    version: '106',\n  },\n  cpu: {\n    architecture: undefined,\n  },\n  device: {\n    model: undefined,\n    type: 'desktop',\n    vendor: undefined,\n  },\n  engine: {\n    name: 'Blink',\n    version: '106',\n  },\n  mobileOS: undefined,\n  os: {\n    name: 'Windows',\n    version: undefined,\n  },\n  sameSiteNoneCompatible: true,\n};\n")),(0,a.kt)("p",null,"When parsing headers with high entropy,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'const headers = {\n  \'sec-ch-ua-full-version-list\':\n    \'"Not.A/Brand";v="8.0.0.0", "Chromium";v="110.0.5481.100", "Google Chrome";v="110.0.5481.100"\',\n  \'sec-ch-ua-platform-version\': \'"10.0.19044.2364"\',\n  \'sec-ch-ua-arch\': \'"x86_64"\',\n  \'sec-ch-ua-model\': \'"iPhone 13"\',\n};\n')),(0,a.kt)("p",null,"We get"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const userAgent = {\n  browser: {\n    browserEngine: 'chrome',\n    major: '110.0.5481.100',\n    name: 'chrome',\n    version: '110.0.5481.100',\n  },\n  cpu: {\n    architecture: 'x86_64',\n  },\n  device: {\n    model: 'iPhone 13',\n    type: 'desktop',\n    vendor: undefined,\n  },\n  engine: {\n    name: 'Blink',\n    version: '110.0.5481.100',\n  },\n  mobileOS: undefined,\n  os: {\n    name: undefined,\n    version: '10.0.19044.2364',\n  },\n  sameSiteNoneCompatible: true,\n};\n")),(0,a.kt)("h2",{id:"parseclienthintsuseragentdata"},"parseClientHintsUserAgentData"),(0,a.kt)("p",null,"Used on the ",(0,a.kt)("strong",{parentName:"p"},"client")," to supplement information from navigator.userAgentData."),(0,a.kt)("p",null,"The parseClientHintsUserAgentData method enriches the object with browser information, fills in additional fields, and ensures backward compatibility in naming. Essentially, it performs data preparation and some data hygiene."),(0,a.kt)("p",null,"For example, when parsing:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const userAgentData = {\n  brands: [\n    {\n      brand: 'Not.A/Brand',\n      version: '8',\n    },\n    {\n      brand: 'Chromium',\n      version: '114',\n    },\n    {\n      brand: 'Google Chrome',\n      version: '114',\n    },\n  ],\n  mobile: true,\n  platform: 'Android',\n};\n")),(0,a.kt)("p",null,"We get"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const userAgent = {\n  browser: {\n    browserEngine: 'chrome',\n    major: '114',\n    name: 'chrome',\n    version: '114',\n  },\n  cpu: {\n    architecture: undefined,\n  },\n  device: {\n    model: undefined,\n    type: 'mobile',\n    vendor: undefined,\n  },\n  engine: {\n    name: 'Blink',\n    version: '114',\n  },\n  mobileOS: 'android',\n  os: {\n    name: 'Android',\n    version: undefined,\n  },\n  sameSiteNoneCompatible: true,\n};\n")),(0,a.kt)("h2",{id:"parseuseragentheader"},"parseUserAgentHeader"),(0,a.kt)("p",null,"Used in the following cases:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Headers are unavailable on the ",(0,a.kt)("strong",{parentName:"li"},"server"),"."),(0,a.kt)("li",{parentName:"ul"},"There were errors in obtaining navigator.userAgentData on the ",(0,a.kt)("strong",{parentName:"li"},"client"),".")),(0,a.kt)("p",null,"The parseUserAgentHeader method parses the userAgent string and returns an object with browser data. For example, when parsing ",(0,a.kt)("inlineCode",{parentName:"p"},"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36")," We get"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"const userAgent = {\n  browser: {\n    browserEngine: 'chrome',\n    major: '83',\n    name: 'chrome',\n    version: '83.0.4103.61',\n  },\n  cpu: {\n    architecture: undefined,\n  },\n  device: {\n    model: undefined,\n    type: undefined,\n    vendor: undefined,\n  },\n  engine: {\n    name: 'Blink',\n    version: '83.0.4103.61',\n  },\n  mobileOS: undefined,\n  os: {\n    name: 'Mac OS',\n    version: '10.15.4',\n  },\n  sameSiteNoneCompatible: true,\n};\n")),(0,a.kt)("h2",{id:"isbrowsersatisfiesrequirements"},"isBrowserSatisfiesRequirements"),(0,a.kt)("p",null,"The function isBrowserSatisfiesRequirements checks if a given user agent satisfies the specified browser requirements based on a browserslist configuration. It parses the user agent to determine the browser and its version, normalizes the browserslist configuration, and compares the browser version against the specified requirements. The function returns true if the browser meets the requirements, false if it does not, and null if the browser is not found in the browserslist. It also handles special cases for Chromium-based browsers and allows forcing the use of minimum requested versions for browsers with incomplete statistics."))}d.isMDXComponent=!0}}]);