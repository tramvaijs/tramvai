"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[285],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),s=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return o.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=s(t),m=r,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return t?o.createElement(f,i(i({ref:n},u),{},{components:t})):o.createElement(f,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=p;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var s=2;s<a;s++)i[s]=t[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},1658:function(e,n,t){t.r(n),t.d(n,{assets:function(){return l},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return a},metadata:function(){return c},toc:function(){return s}});var o=t(7462),r=(t(7294),t(3905));const a={id:"how-cancel-navigation",title:"How to cancel SPA navigation?"},i=void 0,c={unversionedId:"how-to/how-cancel-navigation",id:"how-to/how-cancel-navigation",title:"How to cancel SPA navigation?",description:"You can use cancel() method of a Router to cancel SPA navigation. Method works inside any hook or guard and only when navigation is in progress",source:"@site/tmp-docs/how-to/how-cancel-navigation.md",sourceDirName:"how-to",slug:"/how-to/how-cancel-navigation",permalink:"/docs/how-to/how-cancel-navigation",draft:!1,editUrl:"https://github.com/tramvaijs/tramvai/-/edit/master/docs/tmp-docs/how-to/how-cancel-navigation.md",tags:[],version:"current",frontMatter:{id:"how-cancel-navigation",title:"How to cancel SPA navigation?"},sidebar:"sidebar",previous:{title:"Separating code for server and client",permalink:"/docs/guides/universal"},next:{title:"How to split a component into an asynchronous chunk?",permalink:"/docs/how-to/how-create-async-component"}},l={},s=[{value:"Case 1. Cancel navigation after some time",id:"case-1-cancel-navigation-after-some-time",level:3},{value:"Case 2. Resume navigation after it has been canceled",id:"case-2-resume-navigation-after-it-has-been-canceled",level:3}],u={toc:s};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"cancel()")," method of a Router to cancel SPA navigation. Method works inside any hook or guard and only when navigation is in progress"),(0,r.kt)("h3",{id:"case-1-cancel-navigation-after-some-time"},"Case 1. Cancel navigation after some time"),(0,r.kt)("p",null,"Imagine we have to cancel SPA navigation if it takes too long:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { commandLineListTokens, declareModule, provide } from '@tramvai/core';\nimport { ROUTER_TOKEN } from '@tramvai/tokens-router';\n\nconst SHOW_NAVIGATION_ERROR_AFTER_MS = 30 * 1000;\n\nexport const SpaNavigationInterceptorModule = declareModule({\n  name: 'SpaNavigationInterceptorModule',\n  providers: [\n    provide({\n      provide: commandLineListTokens.customerStart,\n      multi: true,\n      useFactory: ({ router }) => {\n        return () => {\n          router.registerHook('beforeResolve', async (navigation) => {\n            errorTimeoutId = setTimeout(function () {\n              console.log('showing error...');\n\n              cancelled = router.cancel()!;\n            }, SHOW_NAVIGATION_ERROR_AFTER_MS);\n          });\n\n          router.registerHook('afterNavigate', async (navigation) => {\n            clearTimeout(errorTimeoutId);\n          });\n        };\n      },\n      deps: {\n        router: ROUTER_TOKEN,\n      },\n    }),\n  ],\n});\n")),(0,r.kt)("h3",{id:"case-2-resume-navigation-after-it-has-been-canceled"},"Case 2. Resume navigation after it has been canceled"),(0,r.kt)("p",null,'Let\'s make the case harder. We have to show error notification if SPA navigation takes too long time. Once navigation is completed we have to tell the user "We\'ve loaded the page, do you want to continue?" and resume navigation if the user clicks "Yes"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { commandLineListTokens, declareModule, provide } from '@tramvai/core';\nimport { ROUTER_TOKEN } from '@tramvai/tokens-router';\n\nconst SHOW_NAVIGATION_ERROR_AFTER_MS = 30 * 1000;\n\nexport const SpaNavigationInterceptorModule = declareModule({\n  name: 'SpaNavigationInterceptorModule',\n  providers: [\n    provide({\n      provide: commandLineListTokens.customerStart,\n      multi: true,\n      useFactory: ({ router }) => {\n        return () => {\n          let cancelled: Navigation | undefined;\n\n          router.registerHook('beforeResolve', async (navigation) => {\n            errorTimeoutId = setTimeout(function () {\n              errorNotificationId = notifier.add({\n                title: 'Error loading page',\n                type: 'error',\n                timer: false,\n              });\n\n              cancelled = router.cancel()!;\n            }, SHOW_NAVIGATION_ERROR_AFTER_MS);\n          });\n\n          // This hook will be called just before the navigation commiting. We can be sure the navigation is completed\n          router.registerHook('beforeNavigate', async (navigation) => {\n            // Show info notification if:\n            // - there is error notification\n            // - current navigation is the cancelled one (for cases when user has clicked several links)\n            if (\n              errorNotificationId &&\n              cancelled?.url?.href === navigation.url?.href\n            ) {\n              clear(notifier);\n\n              completedNotificationId = notifier.add({\n                text: \"We've loaded the page, do you want to continue?\",\n                actionText: 'Continue!',\n                onActionConfirm: () => {\n                  // Since now cancelled navigation inside router's cache, so we can safely call router.navigate\n                  router.navigate(cancelled!.url!.href);\n                },\n                timer: false,\n              });\n            } else {\n              return Promise.resolve();\n            }\n          });\n\n          router.registerHook('afterNavigate', async (navigation) => {\n            // Clear all notifications and timeouts if real navigation has happened\n            if (!navigation.skipped) {\n              clear(notifier);\n            }\n          });\n        };\n      },\n      deps: {\n        router: ROUTER_TOKEN,\n        notifier: NOTIFICATION_MANAGER,\n      },\n    }),\n  ],\n});\n")))}d.isMDXComponent=!0}}]);