"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6506],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var l=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,l,i=function(e,t){if(null==e)return{};var n,l,i={},o=Object.keys(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=l.createContext({}),p=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return l.createElement(s.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},c=l.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),c=p(n),d=i,m=c["".concat(s,".").concat(d)]||c[d]||f[d]||o;return n?l.createElement(m,r(r({ref:t},u),{},{components:n})):l.createElement(m,r({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:i,r[1]=a;for(var p=2;p<o;p++)r[p]=n[p];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}c.displayName="MDXCreateElement"},998:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>f,frontMatter:()=>o,metadata:()=>a,toc:()=>p});var l=n(7462),i=(n(7294),n(3905));const o={id:"polyfills-eslint",title:"Feature usage linting"},r=void 0,a={unversionedId:"features/build/polyfills-eslint",id:"features/build/polyfills-eslint",title:"Feature usage linting",description:"Default",source:"@site/tmp-docs/03-features/015-build/04-eslint-polyfills.md",sourceDirName:"03-features/015-build",slug:"/features/build/polyfills-eslint",permalink:"/docs/features/build/polyfills-eslint",draft:!1,editUrl:"https://github.com/tramvaijs/tramvai/-/edit/master/docs/tmp-docs/03-features/015-build/04-eslint-polyfills.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"polyfills-eslint",title:"Feature usage linting"},sidebar:"sidebar",previous:{title:"Polyfills Integration",permalink:"/docs/features/build/polyfills"},next:{title:"Overview",permalink:"/docs/features/child-app/overview"}},s={},p=[{value:"Default",id:"default",level:2},{value:"Extend Polyfill List / Custom Browserslist",id:"extend-polyfill-list--custom-browserslist",level:2},{value:"Under the Hood",id:"under-the-hood",level:2},{value:"Extending Web Polyfills",id:"extending-web-polyfills",level:2},{value:"Extending with Custom Polyfills",id:"extending-with-custom-polyfills",level:2},{value:"FAQ",id:"faq",level:2},{value:"Does the custom setup work with legacy ESLint config?",id:"does-the-custom-setup-work-with-legacy-eslint-config",level:3}],u={toc:p};function f({components:e,...t}){return(0,i.kt)("wrapper",(0,l.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"default"},"Default"),(0,i.kt)("p",null,"When using polyfills from the ",(0,i.kt)("inlineCode",{parentName:"p"},"@tinkoff/pack-polyfills")," package, you can enable ESLint rules from the ",(0,i.kt)("inlineCode",{parentName:"p"},"@tinkoff/eslint-plugin-tramvai")," package. To do this, add the following to your ",(0,i.kt)("inlineCode",{parentName:"p"},".eslintrc")," config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "extends": {\n    "plugin:@tinkoff/tramvai/compat"\n  }\n}\n')),(0,i.kt)("p",null,"This config uses the default list of polyfills from ",(0,i.kt)("inlineCode",{parentName:"p"},"@tinkoff/pack-polyfills")," and the default browserslist query from ",(0,i.kt)("inlineCode",{parentName:"p"},"@tinkoff/browserslist-config"),", and it forbids using language features for which no polyfills are provided."),(0,i.kt)("h2",{id:"extend-polyfill-list--custom-browserslist"},"Extend Polyfill List / Custom Browserslist"),(0,i.kt)("p",null,"If you expand the list of polyfills or change the browserslist in your project, the rule will start producing incorrect errors because it relies on the default settings. Fortunately, ",(0,i.kt)("inlineCode",{parentName:"p"},"@tinkoff/eslint-plugin-tramvai")," can generate lint rules based on your custom settings. However, since ESLint does not allow accessing project settings or passing arguments during plugin initialization, you need a small setup:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," file next to your ",(0,i.kt)("inlineCode",{parentName:"p"},".eslintrc")," config (e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-tramvai.js"),")")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In this file, get the ESLint config based on your custom settings:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { getCustomEslintPlugin } = require('@tinkoff/eslint-plugin-tramvai');\n\n// !important, provide root of your project (where package.json and tramvai.json are located)\n// in most cases, this is __dirname\nconst { configs } = getCustomEslintPlugin(__dirname);\n\nmodule.exports = { ...configs.compat };\n")),(0,i.kt)("p",null,"The plugin will automatically use your custom browserslist config and the list of connected polyfills from the polyfill entrypoints."),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Extend your ESLint config:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "extends": {\n    "./eslint-plugin-tramvai"\n  }\n}\n')),(0,i.kt)("p",null,"Make sure to remove the default ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin:@tinkoff/tramvai/compat")," config."),(0,i.kt)("h2",{id:"under-the-hood"},"Under the Hood"),(0,i.kt)("p",null,"Internally, the plugin uses ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-es-x")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-compat"),". ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-es-x")," is used for linting ECMAScript APIs, and ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-compat")," for linting Web APIs."),(0,i.kt)("p",null,"By default, ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-es-x")," doesn\u2019t support browserslist queries. To address this, the plugin uses ",(0,i.kt)("inlineCode",{parentName:"p"},"@automattic/eslint-config-target-es"),", which maps a browserslist query to a set of rules that forbid usage of unsupported language features."),(0,i.kt)("p",null,"We\u2019ve also added functionality to parse used polyfills from the project entrypoints and automatically disable rules when a polyfill is present. Unfortunately, this automatic detection only works for ",(0,i.kt)("inlineCode",{parentName:"p"},"core-js")," polyfills and a few widely used libraries (",(0,i.kt)("a",{parentName:"p",href:"https://formatjs.github.io/docs/polyfills/"},"@formatjs")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/petamoriken/float16"},"@petamoriken/float16"),")."),(0,i.kt)("h2",{id:"extending-web-polyfills"},"Extending Web Polyfills"),(0,i.kt)("p",null,"Because we can\u2019t predict which polyfill you\u2019ll use for Web APIs, you need to manually add them (this is also true for Web APIs in core-js, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"structuredClone"),")."),(0,i.kt)("p",null,"For example, to polyfill ",(0,i.kt)("inlineCode",{parentName:"p"},"ResizeObserver"),", first add it in the polyfill entrypoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"if (!('ResizeObserver' in window)) {\n  require('resize-observer-polyfill/dist/ResizeObserver.global');\n}\n")),(0,i.kt)("p",null,"Then, tell ",(0,i.kt)("inlineCode",{parentName:"p"},"eslint-plugin-compat")," that a polyfill is available by adding this to your ESLint config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "settings": {\n    "polyfills": ["ResizeObserver"]\n  }\n}\n')),(0,i.kt)("h2",{id:"extending-with-custom-polyfills"},"Extending with Custom Polyfills"),(0,i.kt)("p",null,"The same applies to custom polyfills or non-core-js polyfills. You need to manually disable the relevant rule:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import './my-custom-promise-try.polyfill';\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "rules": [\n    "es-x/no-promise-try": 0\n  ]\n}\n')),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://eslint-community.github.io/eslint-plugin-es-x/"},"Full list of rules")),(0,i.kt)("h2",{id:"faq"},"FAQ"),(0,i.kt)("h3",{id:"does-the-custom-setup-work-with-legacy-eslint-config"},"Does the custom setup work with legacy ESLint config?"),(0,i.kt)("p",null,"Yes, it\u2019s fully designed for legacy config. Flat config is not supported."))}f.isMDXComponent=!0}}]);