"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1729],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,u=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(n),c=i,m=d["".concat(u,".").concat(c)]||d[c]||g[c]||r;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7707:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const r={id:"internationalization",title:"Internationalization (i18n)"},o=void 0,l={unversionedId:"features/internationalization",id:"features/internationalization",title:"Internationalization (i18n)",description:"Explanation",source:"@site/tmp-docs/03-features/019-internationalization.md",sourceDirName:"03-features",slug:"/features/internationalization",permalink:"/docs/features/internationalization",draft:!1,editUrl:"https://github.com/tramvaijs/tramvai/-/edit/master/docs/tmp-docs/03-features/019-internationalization.md",tags:[],version:"current",sidebarPosition:19,frontMatter:{id:"internationalization",title:"Internationalization (i18n)"},sidebar:"sidebar",previous:{title:"PWA (Progressive Web App)",permalink:"/docs/features/pwa"},next:{title:"Introduction to tramvai",permalink:"/docs/concepts/overview"}},u={},s=[{value:"Explanation",id:"explanation",level:2},{value:"Key features",id:"key-features",level:3},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Basic setup",id:"basic-setup",level:3},{value:"Configuration options",id:"configuration-options",level:3},{value:"Routing strategies",id:"routing-strategies",level:2},{value:"<code>prefix_except_default</code> (Recommended)",id:"prefix_except_default-recommended",level:3},{value:"<code>prefix</code>",id:"prefix",level:3},{value:"<code>prefix_and_default</code>",id:"prefix_and_default",level:3},{value:"<code>no_prefix</code>",id:"no_prefix",level:3},{value:"Update strategies",id:"update-strategies",level:3},{value:"Reload",id:"reload",level:4},{value:"Update",id:"update",level:4},{value:"Language detection",id:"language-detection",level:2},{value:"Language detection flow",id:"language-detection-flow",level:3},{value:"How to",id:"how-to",level:2},{value:"How to get the current language",id:"how-to-get-the-current-language",level:3},{value:"How to switch language",id:"how-to-switch-language",level:3},{value:"How to extend language detection",id:"how-to-extend-language-detection",level:3},{value:"How to provide whitelist of available languages",id:"how-to-provide-whitelist-of-available-languages",level:3},{value:"Examples",id:"examples",level:2},{value:"Language switcher component",id:"language-switcher-component",level:3},{value:"Language-aware links",id:"language-aware-links",level:3},{value:"Static Site Generation (SSG)",id:"static-site-generation-ssg",level:3},{value:"Related Documentation",id:"related-documentation",level:2}],p={toc:s};function g({components:e,...t}){return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"explanation"},"Explanation"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"I18nModule")," from ",(0,i.kt)("inlineCode",{parentName:"p"},"@tramvai/module-i18n")," provides core internationalization (i18n) functionality for Tramvai applications. It handles language detection, routing strategies for multi-language URLs, language switching, and SEO meta tags for localized content."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This module provides the ",(0,i.kt)("strong",{parentName:"p"},"infrastructure")," for managing languages and routing. It does ",(0,i.kt)("strong",{parentName:"p"},"not")," handle translations, dictionaries, or text localization - that responsibility belongs to your application or specialized translation libraries.")),(0,i.kt)("h3",{id:"key-features"},"Key features"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Automatically determines user's preferred language based on cookies, browser preferences, and URL"),(0,i.kt)("li",{parentName:"ul"},"Supports multiple URL strategies (subpath-based like ",(0,i.kt)("inlineCode",{parentName:"li"},"/en/about")," or no prefix)"),(0,i.kt)("li",{parentName:"ul"},"Provides API to programmatically change the application language"),(0,i.kt)("li",{parentName:"ul"},"Automatically sets the ",(0,i.kt)("inlineCode",{parentName:"li"},"lang")," attribute on the HTML element")),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("p",null,"Install the module:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npx tramvai add @tramvai/module-i18n\n")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"basic-setup"},"Basic setup"),(0,i.kt)("p",null,"Import and add the module to your application:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { createApp } from '@tramvai/core';\nimport { I18nModule } from '@tramvai/module-i18n';\nimport { ClientHintsModule } from '@tramvai/module-client-hints';\n\ncreateApp({\n  name: 'my-app',\n  modules: [\n    ClientHintsModule,\n    I18nModule.forRoot({\n      defaultLanguage: 'ru',\n      availableLanguages: ['ru', 'en'],\n      routingStrategy: 'prefix_except_default',\n    }),\n  ],\n});\n")),(0,i.kt)("h3",{id:"configuration-options"},"Configuration options"),(0,i.kt)("p",null,"Configure the module using ",(0,i.kt)("inlineCode",{parentName:"p"},"I18nModule.forRoot()")," or by providing the ",(0,i.kt)("inlineCode",{parentName:"p"},"I18N_CONFIGURATION_TOKEN"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { I18N_CONFIGURATION_TOKEN } from '@tramvai/module-i18n';\n\nconst provider = provide({\n  provide: I18N_CONFIGURATION_TOKEN,\n  useValue: {\n    defaultLanguage: 'ru',\n    availableLanguages: ['ru', 'en'],\n    routingStrategy: 'prefix_except_default',\n  },\n});\n")),(0,i.kt)("h2",{id:"routing-strategies"},"Routing strategies"),(0,i.kt)("p",null,"The module supports different strategies for handling language in URLs, inspired by ",(0,i.kt)("a",{parentName:"p",href:"https://i18n.nuxtjs.org/docs/guide#strategies"},"Nuxt i18n"),":"),(0,i.kt)("h3",{id:"prefix_except_default-recommended"},(0,i.kt)("inlineCode",{parentName:"h3"},"prefix_except_default")," (Recommended)"),(0,i.kt)("p",null,"Adds language prefix to URLs for all languages ",(0,i.kt)("strong",{parentName:"p"},"except")," the default one:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"defaultLanguage: 'ru'\navailableLanguages: ['ru', 'en']\n\n/ \u2192 Russian\n/about \u2192 Russian\n/en/about \u2192 English\n")),(0,i.kt)("h3",{id:"prefix"},(0,i.kt)("inlineCode",{parentName:"h3"},"prefix")),(0,i.kt)("p",null,"Adds language prefix to ",(0,i.kt)("strong",{parentName:"p"},"all")," URLs including the default language:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"defaultLanguage: 'ru'\navailableLanguages: ['ru', 'en']\n\n/ru/ \u2192 Russian\n/ru/about \u2192 Russian\n/en/about \u2192 English\n")),(0,i.kt)("h3",{id:"prefix_and_default"},(0,i.kt)("inlineCode",{parentName:"h3"},"prefix_and_default")),(0,i.kt)("p",null,"Similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"prefix"),", but also allows accessing default language without prefix:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"defaultLanguage: 'ru'\navailableLanguages: ['ru', 'en']\n\n/ \u2192 Russian\n/ru/ \u2192 Russian\n/about \u2192 Russian\n/ru/about \u2192 Russian\n/en/about \u2192 English\n")),(0,i.kt)("h3",{id:"no_prefix"},(0,i.kt)("inlineCode",{parentName:"h3"},"no_prefix")),(0,i.kt)("p",null,"No language prefix in URLs. Language is determined by cookies, headers, or other means:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/ \u2192 Determined by detection algorithm\n/about \u2192 Determined by detection algorithm\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Use case:")," When using subdomains (en.example.com, ru.example.com) or single-language applications with optional language switching."),(0,i.kt)("h3",{id:"update-strategies"},"Update strategies"),(0,i.kt)("h4",{id:"reload"},"Reload"),(0,i.kt)("p",null,"When switching languages, the page is fully reloaded:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"I18nModule.forRoot({\n  updateStrategy: 'reload', // default\n});\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Pros:")," Simple, guarantees fresh data, no stale state"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Cons:")," Slower, loses client-side state")),(0,i.kt)("h4",{id:"update"},"Update"),(0,i.kt)("p",null,"When switching languages, the page updates without reload using SPA navigation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"I18nModule.forRoot({\n  updateStrategy: 'update',\n});\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Pros:")," Faster, preserves client-side state"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Cons:")," Requires handling language change in components, potential stale data")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"When using ",(0,i.kt)("inlineCode",{parentName:"p"},"updateStrategy: 'update'"),", make sure your components react to language changes. The ",(0,i.kt)("inlineCode",{parentName:"p"},"tramvai_i18n")," store will be updated, so use ",(0,i.kt)("inlineCode",{parentName:"p"},"useStore")," to subscribe to language changes.")),(0,i.kt)("h2",{id:"language-detection"},"Language detection"),(0,i.kt)("p",null,"The module automatically detects the user's preferred language using the following priority:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Cookie")," (priority ",(0,i.kt)("inlineCode",{parentName:"li"},"40"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"tramvai_locale")," by default) - User's previously selected language"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Accept-Language header / navigator.languages")," (priority ",(0,i.kt)("inlineCode",{parentName:"li"},"30"),") - Browser language preferences"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"URL prefix")," (priority ",(0,i.kt)("inlineCode",{parentName:"li"},"20"),") - Language extracted from URL path (if routing strategy uses prefixes)"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Default language")," (priority ",(0,i.kt)("inlineCode",{parentName:"li"},"10"),") - Fallback from configuration")),(0,i.kt)("p",null,"This algorithm is implemented in the ",(0,i.kt)("inlineCode",{parentName:"p"},"I18N_RESOLVE_LANGUAGE_TOKEN")," provider and can be extended by providing multi-token ",(0,i.kt)("inlineCode",{parentName:"p"},"I18N_RESOLVE_LANGUAGE_SOURCE_TOKEN")," (or customized by providing your own implementation of ",(0,i.kt)("inlineCode",{parentName:"p"},"I18N_RESOLVE_LANGUAGE_TOKEN"),")."),(0,i.kt)("h3",{id:"language-detection-flow"},"Language detection flow"),(0,i.kt)("p",null,"Language detection happens during the command line runner stage specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"resolveLanguagesCommandLineStage")," (default: ",(0,i.kt)("inlineCode",{parentName:"p"},"customerStart"),"):"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"I18N_RESOLVE_AVAILABLE_LANGUAGES_TOKEN")," is called to get the list of available languages"),(0,i.kt)("li",{parentName:"ol"},"Available languages are stored in the ",(0,i.kt)("inlineCode",{parentName:"li"},"tramvai_i18n")," store"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"I18N_RESOLVE_LANGUAGE_TOKEN")," is called to detect current language"),(0,i.kt)("li",{parentName:"ol"},"Inside ",(0,i.kt)("inlineCode",{parentName:"li"},"I18N_RESOLVE_LANGUAGE_TOKEN"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"I18N_RESOLVE_LANGUAGE_SOURCE_TOKEN")," providers are executed in order of priority, before first successful result is returned"),(0,i.kt)("li",{parentName:"ol"},"Current language is stored in the store and saved to cookie (if not already set)")),(0,i.kt)("h2",{id:"how-to"},"How to"),(0,i.kt)("h3",{id:"how-to-get-the-current-language"},"How to get the current language"),(0,i.kt)("p",null,"In React components, prefer using the ",(0,i.kt)("inlineCode",{parentName:"p"},"useLanguageService")," hook (with automatic ",(0,i.kt)("inlineCode",{parentName:"p"},"I18nStore")," subscription):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useDi } from '@tramvai/react';\nimport { useLanguageService } from '@tramvai/module-i18n';\n\nexport const MyComponent = () => {\n  const i18nService = useLanguageService();\n  const currentLanguage = i18nService.getLanguage();\n\n  return <div>Current language: {currentLanguage}</div>;\n};\n")),(0,i.kt)("p",null,"As alternative, you can also get the current language directly from the store:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useStoreSelector } from '@tramvai/state';\nimport { I18nStore } from '@tramvai/module-i18n';\nimport { useDi } from '@tramvai/react';\n\nexport const MyComponent = () => {\n  const currentLanguage = useStoreSelector(I18nStore, (state) => state.language);\n\n  return <div>Current language: {currentLanguage}</div>;\n};\n")),(0,i.kt)("h3",{id:"how-to-switch-language"},"How to switch language"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useDi } from '@tramvai/react';\nimport { useLanguageService } from '@tramvai/module-i18n';\n\nexport const MyComponent = () => {\n  const i18nService = useLanguageService();\n\n  const switchLanguage = (lang: string) => {\n    i18nService.switchLanguage(lang);\n  };\n\n  return <button onClick={() => switchLanguage('en')}>Switch to English</button>;\n};\n")),(0,i.kt)("h3",{id:"how-to-extend-language-detection"},"How to extend language detection"),(0,i.kt)("p",null,"Extend the language detection algorithm:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { provide } from '@tramvai/core';\nimport { I18N_RESOLVE_LANGUAGE_SOURCE_TOKEN, LanguageSourcePriority } from '@tramvai/module-i18n';\n\nprovide({\n  provide: I18N_RESOLVE_LANGUAGE_SOURCE_TOKEN,\n  useFactory: ({ config, myApiService, defaultResolve }) => {\n    return {\n      name: 'my-api',\n      // Higher priority than \"cookie\" source\n      priority: LanguageSourcePriority.User,\n      resolve: async () => {\n        const language = await myApiService.detectLanguage();\n        return language;\n      },\n    };\n  },\n  deps: {\n    config: I18N_CONFIGURATION_TOKEN,\n    myApiService: MY_API_SERVICE_TOKEN,\n  },\n});\n")),(0,i.kt)("h3",{id:"how-to-provide-whitelist-of-available-languages"},"How to provide whitelist of available languages"),(0,i.kt)("p",null,"Override the list of available languages (e.g., fetch from API):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { provide } from '@tramvai/core';\nimport { I18N_RESOLVE_AVAILABLE_LANGUAGES_TOKEN } from '@tramvai/module-i18n';\n\nprovide({\n  provide: I18N_RESOLVE_AVAILABLE_LANGUAGES_TOKEN,\n  useFactory: ({ httpClient }) => {\n    return async () => {\n      const { payload } = await httpClient.get('/api/available-languages');\n      return payload.languages;\n    };\n  },\n  deps: {\n    httpClient: HTTP_CLIENT_TOKEN,\n  },\n});\n")),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("h3",{id:"language-switcher-component"},"Language switcher component"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useStoreSelector, useActions } from '@tramvai/state';\nimport { useDi } from '@tramvai/react';\nimport { useLanguageService, I18nStore } from '@tramvai/module-i18n';\n\nexport const LanguageSwitcher = () => {\n  const i18nService = useLanguageService();\n  const currentLanguage = useStoreSelector(I18nStore, (state) => state.language);\n  const availableLanguages = useStoreSelector(I18nStore, (state) => state.availableLanguages);\n\n  const handleChange = (lang: string) => {\n    i18nService.switchLanguage(lang);\n  };\n\n  return (\n    <select value={currentLanguage} onChange={(e) => handleChange(e.target.value)}>\n      {availableLanguages.map((lang) => (\n        <option key={lang} value={lang}>\n          {lang.toUpperCase()}\n        </option>\n      ))}\n    </select>\n  );\n};\n")),(0,i.kt)("h3",{id:"language-aware-links"},"Language-aware links"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useDi } from '@tramvai/react';\nimport { useLanguageService } from '@tramvai/module-i18n';\nimport { Link } from '@tramvai/module-router';\n\nexport const LocaleLink = ({\n  url,\n  lang,\n  children,\n}: {\n  url: string;\n  lang?: Language;\n  children: React.ReactNode;\n}) => {\n  const i18nService = useLanguageService();\n\n  // Add language prefix to internal links\n  const localizedHref = i18nService.addLanguageToUrl(url, lang ?? i18nService.getLanguage());\n\n  return <Link url={localizedHref.pathname}>{children}</Link>;\n};\n")),(0,i.kt)("h3",{id:"static-site-generation-ssg"},"Static Site Generation (SSG)"),(0,i.kt)("p",null,"SSG support with ",(0,i.kt)("inlineCode",{parentName:"p"},"--lang")," flag for generating pages for specific languages is planned but not yet implemented."),(0,i.kt)("p",null,"As workaround, you can provide a custom header ",(0,i.kt)("inlineCode",{parentName:"p"},"Accept-Language")," for ",(0,i.kt)("inlineCode",{parentName:"p"},"tramvai static")," command to generate pages for specific languages, e.g. with ",(0,i.kt)("inlineCode",{parentName:"p"},"en")," in priority:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'npx tramvai static --header "Accept-Language: en-US,en;q=0.9,ru;q=0.8" --folder "en"\n')),(0,i.kt)("h2",{id:"related-documentation"},"Related Documentation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/features/routing/overview"},"Routing")," - Route configuration and navigation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/features/seo"},"SEO")," - Meta tags and SEO optimization"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/features/state-management"},"State Management")," - Working with stores"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/references/modules/client-hints"},"Client Hints")," - Browser preferences detection")))}g.isMDXComponent=!0}}]);